import{c as U,i as k,e as O,a as P,d as K,b as B,f as Q,g as X,h as Y,m as $}from"./graphic-ca490178.js";import{i as I,c as H,s as ee,e as ae,a as ne,C as ie,n as z,V as re,g as oe,B as te,S as se,b as le,d as b,f as W,m as fe,h as de,j as ce,k as ue,l as ve,o as me}from"./Axis-22733173.js";function Ee(a,e){return Z(a,e).dimensions}function Z(a,e){I(a)||(a=H(a)),e=e||{};var o=e.coordDimensions||[],n=e.dimensionsDefine||a.dimensionsDefine||[],r=U(),i=[],s=De(a,o,n,e.dimensionsCount),u=e.canOmitUnusedDimensions&&ee(s),c=n===a.dimensionsDefine,C=c?ae(a):ne(n),p=e.encodeDefine;!p&&e.encodeDefaulter&&(p=e.encodeDefaulter(a,s));for(var h=U(p),x=new ie(s),g=0;g<x.length;g++)x[g]=-1;function M(l){var f=x[l];if(f<0){var d=n[l],m=B(d)?d:{name:d},t=new le,S=m.name;S!=null&&C.get(S)!=null&&(t.name=t.displayName=S),m.type!=null&&(t.type=m.type),m.displayName!=null&&(t.displayName=m.displayName);var v=i.length;return x[l]=v,t.storeDimIndex=l,i.push(t),t}return i[f]}if(!u)for(var g=0;g<s;g++)M(g);h.each(function(l,f){var d=z(l).slice();if(d.length===1&&!k(d[0])&&d[0]<0){h.set(f,!1);return}var m=h.set(f,[]);O(d,function(t,S){var v=k(t)?C.get(t):t;v!=null&&v<s&&(m[S]=v,G(M(v),f,S))})});var D=0;O(o,function(l){var f,d,m,t;if(k(l))f=l,t={};else{t=l,f=t.name;var S=t.ordinalMeta;t.ordinalMeta=null,t=P({},t),t.ordinalMeta=S,d=t.dimsDef,m=t.otherDims,t.name=t.coordDim=t.coordDimIndex=t.dimsDef=t.otherDims=null}var v=h.get(f);if(v!==!1){if(v=z(v),!v.length)for(var j=0;j<(d&&d.length||1);j++){for(;D<s&&M(D).coordDim!=null;)D++;D<s&&v.push(D++)}O(v,function(J,w){var N=M(J);if(c&&t.type!=null&&(N.type=t.type),G(K(N,t),f,w),N.name==null&&d){var R=d[w];!B(R)&&(R={name:R}),N.name=N.displayName=R.name,N.defaultTooltip=R.defaultTooltip}m&&K(N.otherDims,m)})}});function G(l,f,d){re.get(f)!=null?l.otherDims[f]=d:(l.coordDim=f,l.coordDimIndex=d,r.set(f,!0))}var F=e.generateCoord,A=e.generateCoordCount,T=A!=null;A=F?A||1:0;var V=F||"value";function L(l){l.name==null&&(l.name=l.coordDim)}if(u)O(i,function(l){L(l)}),i.sort(function(l,f){return l.storeDimIndex-f.storeDimIndex});else for(var _=0;_<s;_++){var y=M(_),q=y.coordDim;q==null&&(y.coordDim=ye(V,r,T),y.coordDimIndex=0,(!F||A<=0)&&(y.isExtraCoord=!0),A--),L(y),y.type==null&&(oe(a,_)===te.Must||y.isExtraCoord&&(y.otherDims.itemName!=null||y.otherDims.seriesName!=null))&&(y.type="ordinal")}return ge(i),new se({source:a,dimensions:i,fullDimensionCount:s,dimensionOmitted:u})}function ge(a){for(var e=U(),o=0;o<a.length;o++){var n=a[o],r=n.name,i=e.get(r)||0;i>0&&(n.name=r+(i-1)),i++,e.set(r,i)}}function De(a,e,o,n){var r=Math.max(a.dimensionsDetectedCount||1,e.length,o.length,n||0);return O(e,function(i){var s;B(i)&&(s=i.dimsDef)&&(r=Math.max(r,s.length))}),r}function ye(a,e,o){if(o||e.hasKey(a)){for(var n=0;e.hasKey(a+n);)n++;a+=n}return e.set(a,!0),a}var he=function(){function a(e){this.coordSysDims=[],this.axisMap=U(),this.categoryAxisMap=U(),this.coordSysName=e}return a}();function Ce(a){var e=a.get("coordinateSystem"),o=new he(e),n=pe[e];if(n)return n(a,o,o.axisMap,o.categoryAxisMap),o}var pe={cartesian2d:function(a,e,o,n){var r=a.getReferringComponents("xAxis",b).models[0],i=a.getReferringComponents("yAxis",b).models[0];e.coordSysDims=["x","y"],o.set("x",r),o.set("y",i),E(r)&&(n.set("x",r),e.firstCategoryDimIndex=0),E(i)&&(n.set("y",i),e.firstCategoryDimIndex==null&&(e.firstCategoryDimIndex=1))},singleAxis:function(a,e,o,n){var r=a.getReferringComponents("singleAxis",b).models[0];e.coordSysDims=["single"],o.set("single",r),E(r)&&(n.set("single",r),e.firstCategoryDimIndex=0)},polar:function(a,e,o,n){var r=a.getReferringComponents("polar",b).models[0],i=r.findAxisModel("radiusAxis"),s=r.findAxisModel("angleAxis");e.coordSysDims=["radius","angle"],o.set("radius",i),o.set("angle",s),E(i)&&(n.set("radius",i),e.firstCategoryDimIndex=0),E(s)&&(n.set("angle",s),e.firstCategoryDimIndex==null&&(e.firstCategoryDimIndex=1))},geo:function(a,e,o,n){e.coordSysDims=["lng","lat"]},parallel:function(a,e,o,n){var r=a.ecModel,i=r.getComponent("parallel",a.get("parallelIndex")),s=e.coordSysDims=i.dimensions.slice();O(i.parallelAxisIndex,function(u,c){var C=r.getComponent("parallelAxis",u),p=s[c];o.set(p,C),E(C)&&(n.set(p,C),e.firstCategoryDimIndex==null&&(e.firstCategoryDimIndex=c))})}};function E(a){return a.get("type")==="category"}function Se(a,e){var o=a.get("coordinateSystem"),n=ve.get(o),r;return e&&e.coordSysDims&&(r=$(e.coordSysDims,function(i){var s={name:i},u=e.axisMap.get(i);if(u){var c=u.get("type");s.type=me(c)}return s})),r||(r=n&&(n.getDimensionsInfo?n.getDimensionsInfo():n.dimensions.slice())||["x","y"]),r}function xe(a,e,o){var n,r;return o&&O(a,function(i,s){var u=i.coordDim,c=o.categoryAxisMap.get(u);c&&(n==null&&(n=s),i.ordinalMeta=c.getOrdinalMeta(),e&&(i.createInvertedIndices=!0)),i.otherDims.itemName!=null&&(r=!0)}),!r&&n!=null&&(a[n].otherDims.itemName=0),n}function Fe(a,e,o){o=o||{};var n=e.getSourceManager(),r,i=!1;a?(i=!0,r=H(a)):(r=n.getSource(),i=r.sourceFormat===W);var s=Ce(e),u=Se(e,s),c=o.useEncodeDefaulter,C=Q(c)?c:c?X(fe,u,e):null,p={coordDimensions:u,generateCoord:o.generateCoord,encodeDefine:e.getEncode(),encodeDefaulter:C,canOmitUnusedDimensions:!i},h=Z(r,p),x=xe(h.dimensions,o.createInvertedIndices,s),g=i?null:n.getSharedDataStore(h),M=de(e,{schema:h,store:g}),D=new ce(h,e);D.setCalculationInfo(M);var G=x!=null&&Me(r)?function(F,A,T,V){return V===x?T:this.defaultDimValueGetter(F,A,T,V)}:null;return D.hasItemOption=!1,D.initData(i?r:g,null,G),D}function Me(a){if(a.sourceFormat===W){var e=Ae(a.data||[]);return!Y(ue(e))}}function Ae(a){for(var e=0;e<a.length&&a[e]==null;)e++;return a[e]}export{Ee as a,Fe as c,Z as p};
